# Автоматическое добавление объектов на основе макросов #

<p align="justify">При вставке специально доработанного макроса на страницу Eplan, автоматически произойдет добавление вставляемого базового объекта в редактор. Доработка макроса осуществляется за счет добавления к нему символа, который будет определять макрос, как базовый объект для EasyEplanner.</p>

## Введение ##
<p align="justify">Функционал автоматизирует добавления объектов в редактор технологических объектов. Для того, чтобы сработал триггер - необходимо специальным образом доработать макрос, а именно: на макросе нужно расположить специально подготовленный символ, который ожидает увидеть EasyEplanner при вставке макроса на страницу. Рекомендуется группировать макрос с этим символом, чтобы этот символ не терялся. На вставляемом макросе должен быть строго один символ, который его определяет для EasyEplanner. При присутствии более 1 определяющего символа, системой автоматически будет выбран случайный.</p>

## Подключение готовой библиотеки символов ##
<p align="justify">Готовую библиотеку символов с макросом можно взять на сервере в стандартном каталоге с библиотеками символов (<i>Символы</i>). Название библиотеки - EplannerSymbols. Пример символа на рисунке ниже.</p>

<p align="center"><img src="images/InsertObjectFromMacro/symbolPreview.png"></p>

<p align="center"><b>Рисунок</b> - <i>Пример символа определяющего макрос</i></p>

## Самостоятельное создание символа ##
Если библиотека недоступна, то можно нарисовать свой символ. Графическое отображение символа не имеет значение, системе важно его правильная настройка для его идентификации.

Перед тем, как создать символ, необходимо либо открыть уже существующую библиотеку символов, либо создать новую. Это можно сделать в меню "Сервисные программы" >> "Основные данные" >> "Библиотека символов". Если же опустить этот пункт, а перейти сразу к следующему, то при создании символа, Eplan попросит выбрать библиотеку символов для того, чтобы создать символ в ней. Более подробная информация о библиотеках символа - [здесь](https://www.eplan.help/help/platform/2.5/ru-ru/help/Content/htm/xmasterdatasettingsgui_h_symbolbiblverwalten.htm).

<p align="center"><img src="images/InsertObjectFromMacro/symbolsLibMenu.png"></p>

<p align="center"><b>Рисунок</b> - <i>Меню библиотеки символов</i></p>

Для того, чтобы создать символ, необходимо в Eplan выбрать пункт меню "Сервисные программы" >> "Основные данные" >> "Символы" и там выбрать пункт "Создать".

<p align="center"><img src="images/InsertObjectFromMacro/symbolsMenu.png"></p>

<p align="center"><b>Рисунок</b> - <i>Меню символов</i></p>

Откроется пустое окно для редактирования символа. Графическое отображение, желательно, создать по аналогии с пунктом [подключение готовой библиотеки символов](#Подключение-готовой-библиотеки-символов). Самое главное, правильно настроить функцию символа. Для этого, перейдем в настройки символа, нажав ПКМ на страницу символа и выбрав пункт "Свойства".

<p align="center"><img src="images/InsertObjectFromMacro/symbolPropertyMenu.png"></p>

<p align="center"><b>Рисунок</b> - <i>Меню свойств символа</i></p>

В появившемся окне необходимо правильно заполнить данные. TODO.

## Список функциональных текстов для символа ##
<p align="justify">Список функциональных текстов аналогичен тому, который используется в EasyEplanner для идентификации базовых объектов. Функциональный текст необходимо записать в поле "<b>Функциональный текст</b>" определяющего символа в макросе.</p>

<p align="center"><img src="images/InsertObjectFromMacro/objectNameInFunctionalText.png"></p>

<p align="center"><b>Рисунок</b> - <i>Редактирование функционального текста</i></p>

Таблица с названиями объектов и их функциональными текстами:

  Название объекта | Его функциональный текст
---|---
 Автомат | automat
 Бачок откачки лёдводы | _tank
 Бачок откачки лёдводы ПИД | _tank_PID
 Бойлер | boil
 Ячейка процесса | master
 Линия | line
 Линия приемки | line_in
 Линия выдачи | line_out
 Линия перекачки | line_pumping
 Пастеризатор | pasteurizator
 Пост | post
 Танк | tank
 Узел давления ПИД | pressure_node_PID
 Узел подогрева | heater_node
 Узел подогрева ПИД | heater_node_PID
 Узел расхода ПИД | flow_node_PID
 Узел охлаждения | cooler_node
 Узел охлаждения ПИД | cooler_node_PID
 Узел перемешивания | mix_node
 Узел стерильного возраста | sterile_air_node
 Узел продувания | steam_blast_node
 Узел текущего уровня ПИД | tank_level_node_PID
 Узел текущего уровня | tank_level_node
 Модуль мойки | cip_module
 Пользовательский объект | user_object
 Линия мойки | CIP_node

## Как использовать ##
Для начала, необходимо создать макрос, в котором будет расположен символ, определяющий базовый объект. Для этого, размещаем определяющий символ на ФСА, заполняем его функциональный текст согласно [пункту](#Список-функциональных-текстов-для-символа).

<p align="center"><img src="images/InsertObjectFromMacro/prepareSymbolForMacros.png"></p>

<p align="center"><b>Рисунок</b> - <i>Подготовка символа</i></p>

Затем, выделяем будущий макрос, и не забываем выделить вместе с ним определяющий символ. Жмем ПКМ (<i>правая кнопка мыши</i>) и жмем кнопку "Создать макрос".

<p align="center"><img src="images/InsertObjectFromMacro/createMacrosMenu.png"></p>

<p align="center"><b>Рисунок</b> - <i>Меню создания макроса</i></p>

Выбираем место для сохранения, остальные поля можно заполнить так, как Вам удобно. Жмем "ОК". На этом создание макроса завершено.

<p align="center"><img src="images/InsertObjectFromMacro/createMacros.png"></p>

<p align="center"><b>Рисунок</b> - <i>Создание нового макроса</i></p>

Для использования макроса, необходимо вставить его на ФСА. Для этого, жмем на панели инструментов кнопку "Вставить" и в выпадающем списке выбираем пункт "Вставить макрос".

<p align="center"><img src="images/InsertObjectFromMacro/insertMacrosMenu.png"></p>

<p align="center"><b>Рисунок</b> - <i>Меню вставки макроса</i></p>

Выбираем нужный макрос и жмем ОК. Можно вставлять макрос на ФСА. После вставки макроса, автоматически будет добавлен базовый объект, если определяющий макрос символ был настроен правильно.

<p align="center"><img src="images/InsertObjectFromMacro/afterInsertingMacros.png"></p>

<p align="center"><b>Рисунок</b> - <i>После вставки макроса</i></p>
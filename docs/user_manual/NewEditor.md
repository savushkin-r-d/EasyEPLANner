# Описание различий между старым и новым редактором технологических объектов #

## Содержание ##
 + [Предисловие](#Предисловие)
 + [Различия в дереве объектов](#1-Различия-в-дереве-объектов)
 + [Различия в механизме создания, вставки, удаления, перемещения вверх и вниз объектов](#2-Различия-в-механизме-создания-вставки-удаления-перемещения-вверх-и-вниз-объектов)
    + [Убран глобальный индекс объекта](#21-Убран-глобальный-индекс-объекта)
    + [Создание нового объекта](#22-Создание-нового-объекта)
    + [Копирование, вставка и замена объекта](#23-Копирование-вставка-и-замена-объекта)
    + [Удаление объекта](#24-Удаление-объекта)
    + [Перемещение объектов вверх и вниз](#25-Перемещение-объектов-вверх-и-вниз)
 + [Различия в объектах](#3-Различия-в-объектах)
    + [Привязка объектов](#31-Привязка-объектов)
    + [Настройка ограничений](#32-Настройка-ограничений)
    + [Корректировка базовой операции](#33-Корректировка-базовой-операции)
+  [Загрузка описания при открытии проекта](#4-Загрузка-описания-при-открытии-проекта)
    + [Неопознанные объекты](#41-Неопознанные-объекты)
    + [Что делать с неопознанными объектами](#42-Что-делать-с-неопознанными-объектами)
+  [Импорт и экспорт объектов проекта](#5-Импорт-и-экспорт-объектов-проекта)

### Предисловие ###
<p align="justify">Новый редактор подстроен под модель S-88 рецептурного производства. Мы отошли от универсального объекта и переходим к более уникальным объектам. Появились группы объектов, такие как: "<em>Ячейка процесса</em>", "<em>Аппарат</em>", "<em>Агрегат</em>". В данный момент все внутренние объекты являются теми же универсальными объектами, которые были в старом дереве. По большей части, изменилось отображение дерева, и дополнена функциональность.</p>

### 1 Различия в дереве объектов ###
<p align="justify">Дерево объектов поменялось не сильно, между универсальным объектом и корнем дерева появилось разграничение объектов на тип по <em>S-88</em>. Для примера, ниже представлено старое и новое дерево проектов.</p>

<p align="center"><img src="images/NewEditor/newOldEditorExample.jpg"></p>

<p align="center"><b>Рисунок</b> - <i>Сравнение нового и старого редактора</i></p>

<p align="justify">Добавились такие группы, как "<b>Ячейка процесса</b>", "<b>Агрегат</b>", "<b>Аппарат</b>". Причем, группа "<b>Ячейка процесса</b>" содержит один единственный объект, и не может содержать подтипов. Группы "<b>Агрегат</b>" и "<b>Аппарат</b>" реализуют один тип объектов. Эти группы могут содержать подгруппы, которые будут являться базовыми объектами. Это привело к тому, что пользователю теперь не нужно задавать базовый объект. Он будет задан автоматически.</p>

### 2 Различия в механизме создания, вставки, удаления, перемещения вверх и вниз объектов ###
Дерево изменило вид, как видно из рисунка в предыдущем разделе, некоторые нюансы все же есть.

#### 2.1 Убран глобальный индекс объекта ####
<p align="justify">В новом дереве понятие глобального индекса (<i>номера</i>) объекта было спрятано от пользователя. Пользователь теперь знает только локальный номер объекта, в то время как глобальный номер считает система сама. Глобальный номер объекта создается таким образом, чтобы никогда не было смещения объектов. Таким образом, можно легко добавлять объекты т.к они всегда будут добавляться в конец общего объектного дерева.</p>

#### 2.2 Создание нового объекта ####
<p align="justify">Изменен механизм создания объектов. В старом редакторе всегда создавался универсальный объект, в то время как в новом редакторе есть градация с возможностью создания конкретного базового объекта. В новом редакторе существует три варианта создания объекта: из корня дерева, из корня объекта S-88, из корня базового объекта.</p>

<p align="center"><img src="images/NewEditor/treeRootsExample.jpg"></p>

<p align="center"><b>Рисунок</b> - <i>Обозначение корней элементов</i></p>

<p align="justify">При создании объектов из первых двух корней (<i>корень дерева и корень объекта S-88</i>), будет вызвано диалоговое окно (<i>см. рисунок ниже</i>). В зависимости от того, из какого корня было оно вызвано, будут активированы или деактивированы возможные варианты. Подробности описаны ниже.</p>

<p align="center"><img src="images/NewEditor/createNewObject.jpg"></p>

<p align="center"><b>Рисунок</b> - <i>Создание нового объекта</i></p>

<p align="justify">Например, если создание объекта идет из корня дерева, то все списки в окне создания объекта будут доступны. При создании объекта из корня объекта S-88, так как объект уже известен, то будет заблокирован выбор объекта S-88, а при создании объекта из корня базового объекта, сразу будет создан соответствующий конкретный объект базового объекта без каких либо окон.</p>

<p align="justify">С точки зрения базового объекта ничего не изменилось. Данные в списках берутся из файла-описания базовых объектов, как и в старом редакторе.</p>

#### 2.3 Копирование, вставка и замена объекта ####
<p align="justify">Можно копировать любой объект, но вставить и заменить можно только объект с одинаковым базовым объектом. То есть, мы можем заменить <b>Танк</b> на <b>Танк</b>, но не можем <b>Танк</b> на <b>Линию</b>. Внутри объектов ситуация не изменилась. Мы можем скопировать операцию <b>Танка</b> в операции <b>Линии</b>, но базовая операция должна быть переназначена пользователем.</p>

#### 2.4 Удаление объекта ####
<p align="justify">Ничего не изменилось, но нужно учитывать, что при удалении объекта, его глобальный номер будет удален, а, следовательно, все объекты будут сдвинуты относительно предыдущего их положения.</p>

#### 2.5 Перемещение объектов вверх и вниз ####
<p align="justify">Перемещение объектов вверх и вниз изменяет из глобальные номера путем замены. Объект <b>Х</b> меняется на <b>У</b> и наоборот, как и было в старом редакторе. Но так как в новой реализации мы пользуемся локальными индексами и объекты сгруппированы, то перемещать объект вверх и вниз можно только в пределах одной группы. Выход в другие группы невозможен.</p>

### 3 Различия в объектах ###
<p align="justify">Объект, сам по себе, все ещё тот универсальный, из старого редактора, но с небольшими изменениями и доработками. Для объектов, к которым нельзя привязать другой объект, поле <code>Привязанные агрегаты</code> убрано.</p> 

#### 3.1 Привязка объектов ####
<p align="justify">Привязка агрегатов к аппаратам (<i>хотя, линии у нас относятся к агрегатам, но мы можем привязывать к ним другие агрегаты</i>) теперь выполняется не вручную, а может быть настроена также, как и ограничения (<i>окно "Операции" в режиме редактирования</i>). Пример настройки привязки объектов представлен ниже.</p>

<p align="center"><img src="images/NewEditor/attachObjects.jpg"></p>

<p align="center"><b>Рисунок</b> - <i>Новая привязка объектов</i></p>

<p align="justify">Как видно из рисунка, там где раньше прописывали руками номера объектов, они все ещё отображаются. Что с ними делать, пока не решено.</p>

#### 3.2 Настройка ограничений ####
<p align="justify">Дерево ограничений было изменено в соответствии с деревом объектов. Теперь в нем больше уровней и есть разграничение на аппараты, агрегаты и др. Исправлено изменение ограничений при передвижении объекта вверх или вниз, теперь они работают корректно. В целом, ничего кроме дерева и пары исправлений багов не изменилось.</p>

#### 3.3 Корректировка базовой операции ####
<p align="justify">При установке базовой операции в новой операции (<i>когда имя ещё не менялось</i>), автоматически будет установлено новое имя операции в соответствии с именем базовой операции.</p>

### 4 Загрузка описания при открытии проекта ###
<p align="justify">Загрузка описания практически не изменилась. Старое описание совместимо с новым редактором. Если во время чтения описания была ошибка, то проект будет помечен, как загруженный с ошибкой и он <b>не сохранится</b>.</p>

#### 4.1 Неопознанные объекты ####
<p align="justify">Так как мы ставим во главу нового редактора базовый объект, то если базовый объект будет не распознан системой, добавляемый при загрузке объект будет добавлен в группу "<em>Неопознанные объекты</em>". Пример на рисунке ниже.</p>

<p align="center"><img src="images/NewEditor/unidentifiedObject.jpg"></p>

<p align="center"><b>Рисунок</b> - <i>Неопознанные объекты</i></p>

#### 4.2 Что делать с неопознанными объектами ####
<p align="justify">Неопознанный объект может им и оставаться. Но над ним нельзя выполнять никаких действий, кроме как: "<b>Удалить</b>", "<b>Вырезать</b> и "<b>Редактировать</b>". Если не переносить базовый объект в другие объекты, то он будет сохраняться как неопознанный объект.</p>

<p align="justify">Вырезать объект можно с помощью сочетания клавиш <b>Ctrl + X</b>. После вырезки, объект станет неактивным (<em>будет выделен серым цветом и его нельзя будет выделить</em>). Для того, чтобы отменить вырезку, нужно нажать клавишу <b>Esc</b> при любом активном элементе дерева.</p>

<p align="center"><img src="images/NewEditor/unidentifiedDisabledObject.jpg"></p>

<p align="center"><b>Рисунок</b> - <i>Неопознанные объекты</i></p>

<p align="justify">Для того, чтобы вставить вырезанный объект, необходимо выбрать место, куда его вставить и нажать сочетание клавиш <b>Ctrl + V</b>. С точки зрения программы, будет перенос объекта из одного места в другое, и назначение этому объекту базового объекта в который он был перенесен. Глобальный номер объекта не изменится.</p>

<p align="center"><img src="images/NewEditor/unidentifiedObjectAfterInsert.jpg"></p>

<p align="center"><b>Рисунок</b> - <i>Перенесенный объект</i></p>

<p align="justify">Если нужно перенести объект в базовый объект, которого ещё нет, то нужно нажать сочетание клавиш <b>Ctrl + V</b> на элементе дерева выше (<em>например, если есть объект S88, то нажимаем на Агрегат, Аппарат</em>). Если же нет даже объектов S88, то нажимаем на корень проекта (<em>где название проекта</em>) и нажимаем нужное сочетание клавиш. Когда система не может определить, куда перенести объект, будет вызвано окно (<em>по аналогии с вставкой нового объекта</em>), где нужно выбрать, куда переносится неопознанный объект.</p>

### 5 Импорт и экспорт объектов проекта

<p align="justify">Отображение объектов изменено в соответствии с нынешним деревом. Вместо плоского списка появилось плоское дерево, по аналогии как с ограничениями, привязанный аппаратами и др.</p>
